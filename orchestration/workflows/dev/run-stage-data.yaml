# Kicks off the stage-data workflow in the hca-mvp namespace

apiVersion: argoproj.io/v1alpha1
metadata:
  # todo can namespace be parameterized?
  namespace: hca-mvp
  # argo will auto gen a unique suffix when we use
  # generateName rather than name
  generateName: arh-test-stage-data-
spec:
  entrypoint: main
  onExit: send-slack-notification
  arguments:
    parameters:
      # the argo cli tool will yell if these are not supplied
      - name: source-bucket-name
      - name: source-bucket-prefix
      - name: staging-bucket-prefix
  templates:
    - name: main
      templateRef:
        name: stage-data
      template: main
        inputs:
        parameters:
          - name: source-bucket-name
          - name: source-bucket-prefix
          - name: staging-bucket-prefix
    - name: send-slack-notification
      templateRef:
        name: notification-templates
        template: send-slack-notification
  serviceAccountName: argo-runner
  ttlStrategy:
    secondsAfterSuccess: 86400
    secondsAfterFailure: 604800
  podGC:
    strategy: OnPodSuccess
